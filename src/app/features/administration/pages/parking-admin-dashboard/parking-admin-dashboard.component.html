<div class="p-8 md:p-12 space-y-12 animate-fade-in custom-scrollbar">

  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
    <div>
      <h2 class="text-4xl font-black text-gray-800 tracking-tighter">Panel de Gestión</h2>
      <p class="text-xs font-bold text-gray-400 uppercase tracking-[0.2em] mt-2">Administración Global del Sistema</p>
    </div>

    <div class="flex gap-4">
      <button (click)="openAddOverlay()"
        class="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-3xl text-sm font-black shadow-xl shadow-blue-100 hover:shadow-blue-200 transition-all duration-300 hover:-translate-y-1 flex items-center gap-3 group">
        <svg class="w-5 h-5 text-white/80 group-hover:rotate-90 transition-transform duration-300" fill="none"
          stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        AÑADIR ESPACIOS
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
    <!-- Ocupación -->
    <div class="glass-card p-8 border-l-8 border-blue-600 bg-white/60 group hover:-translate-y-2">
      <div class="flex items-center justify-between mb-4">
        <div class="p-4 bg-blue-100 rounded-3xl text-blue-600 group-hover:scale-110 transition-transform">
          <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z" />
          </svg>
        </div>
        <span
          class="text-[10px] font-black text-blue-600 uppercase tracking-widest bg-blue-50 px-3 py-1 rounded-full">En
          Uso</span>
      </div>
      <div class="text-5xl font-black text-gray-800 tracking-tighter">{{occupiedSpaces}}</div>
      <p class="text-[10px] font-bold text-gray-400 mt-3 uppercase tracking-[0.1em]">Espacios Ocupados de {{
        ParkingSpacesList.length }}</p>
    </div>

    <!-- Reservas -->
    <div class="glass-card p-8 border-l-8 border-amber-500 bg-white/60 group hover:-translate-y-2">
      <div class="flex items-center justify-between mb-4">
        <div class="p-4 bg-amber-100 rounded-3xl text-amber-600 group-hover:scale-110 transition-transform">
          <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
            <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
          </svg>
        </div>
        <span
          class="text-[10px] font-black text-amber-600 uppercase tracking-widest bg-amber-50 px-3 py-1 rounded-full">Espera</span>
      </div>
      <div class="text-5xl font-black text-gray-800 tracking-tighter">{{reservedSpaces}}</div>
      <p class="text-[10px] font-bold text-gray-400 mt-3 uppercase tracking-[0.1em]">Reservas por Llegar</p>
    </div>

    <!-- Mantenimiento -->
    <div class="glass-card p-8 border-l-8 border-rose-500 bg-white/60 group hover:-translate-y-2">
      <div class="flex items-center justify-between mb-4">
        <div class="p-4 bg-rose-100 rounded-3xl text-rose-600 group-hover:scale-110 transition-transform">
          <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
            <path d="M22 19h-2v-4h2v4zm-4 0h-2v-9h2v9zm-4 0h-2V7h2v12zm-4 0H8v-5h2v5zm-4 0H4v-2h2v2z" />
          </svg>
        </div>
        <span
          class="text-[10px] font-black text-rose-600 uppercase tracking-widest bg-rose-50 px-3 py-1 rounded-full">Offline</span>
      </div>
      <div class="text-5xl font-black text-gray-800 tracking-tighter">{{ maintenanceSpaces }}</div>
      <p class="text-[10px] font-bold text-gray-400 mt-3 uppercase tracking-[0.1em]">Fuera de Servicio</p>
    </div>

    <!-- Usuarios -->
    <div class="glass-card p-8 border-l-8 border-emerald-600 bg-white/60 group hover:-translate-y-2">
      <div class="flex items-center justify-between mb-4">
        <div class="p-4 bg-emerald-100 rounded-3xl text-emerald-600 group-hover:scale-110 transition-transform">
          <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.47 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
          </svg>
        </div>
        <span
          class="text-[10px] font-black text-emerald-600 uppercase tracking-widest bg-emerald-50 px-3 py-1 rounded-full">Usuarios</span>
      </div>
      <div class="text-5xl font-black text-gray-800 tracking-tighter">{{ UserList.length }}</div>
      <p class="text-[10px] font-bold text-gray-400 mt-3 uppercase tracking-[0.1em]">Registrados en el Sistema</p>
    </div>
  </div>

  <!-- Gestión de Usuarios Table -->
  <div
    class="bg-white/40 backdrop-blur-xl rounded-[3rem] border border-white/60 shadow-2xl overflow-hidden animate-fade-in-up">
    <div class="px-10 py-10 bg-white/60 border-b border-white/80 flex items-center justify-between">
      <div>
        <h2 class="text-3xl font-black text-gray-800 tracking-tighter">Directorio de Usuarios</h2>
        <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mt-1">Control de acceso y perfiles</p>
      </div>
      <div class="flex items-center gap-4">
        <span
          class="px-4 py-2 bg-blue-600 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg shadow-blue-100">
          {{UserList.length}} Usuarios
        </span>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-50/30">
            <th class="px-10 py-8 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Identidad / Correo
            </th>
            <th class="px-10 py-8 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Nivel de Acceso</th>
            <th class="px-10 py-8 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Estado Actual</th>
            <th class="px-10 py-8 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] text-right">Detalles
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100/50">
          <tr *ngFor="let user of UserList" class="hover:bg-white/80 transition-all duration-300 group">
            <td class="px-10 py-8">
              <div class="flex items-center gap-4">
                <div
                  class="w-12 h-12 bg-gray-900 text-white rounded-2xl flex items-center justify-center font-black text-xs group-hover:rotate-6 transition-transform">
                  {{user.email.substring(0,2).toUpperCase()}}
                </div>
                <div>
                  <div class="text-sm font-black text-gray-800 tracking-tight">{{user.email}}</div>
                </div>
              </div>
            </td>
            <td class="px-10 py-8">
              <span [ngClass]="{
                'bg-blue-50 text-blue-600': user.role === 'administrator',
                'bg-indigo-50 text-indigo-600': user.role !== 'administrator'
              }" class="px-5 py-2 rounded-2xl text-[10px] font-black uppercase tracking-wider">
                {{user.role}}
              </span>
            </td>
            <td class="px-10 py-8">
              <span [ngClass]="{
                'bg-emerald-50 text-emerald-600': user.status === 'active',
                'bg-rose-50 text-rose-600': user.status === 'suspended',
                'bg-gray-100 text-gray-500': user.status === 'inactive'
              }" class="px-5 py-2 rounded-2xl text-[10px] font-black uppercase tracking-wider">
                {{user.status}}
              </span>
            </td>
            <td class="px-10 py-8 text-right">
              <button (click)="openOverlay(user)"
                class="p-4 bg-white hover:bg-gray-900 text-gray-400 hover:text-white rounded-[1.5rem] shadow-sm hover:shadow-xl transition-all duration-500 group/btn">
                <svg class="w-5 h-5 group-hover/btn:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="overlayOpen"
    class="fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-50 p-6 animate-fade-in"
    (click)="closeOverlay()">
    <div class="bg-white/95 backdrop-blur-2xl p-12 rounded-[4rem] shadow-2xl max-w-lg w-full border border-white/50"
      (click)="$event.stopPropagation()">
      <div class="flex flex-col items-center text-center gap-6 mb-10">
        <div
          class="w-24 h-24 bg-blue-600 rounded-[2.5rem] flex items-center justify-center text-white shadow-2xl shadow-blue-200">
          <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
          </svg>
        </div>
        <div>
          <h3 class="text-3xl font-black text-gray-800 tracking-tighter">{{selectedUser?.email}}</h3>
          <p class="text-xs font-bold text-gray-400 uppercase tracking-[0.2em] mt-2">Detalles del Usuario</p>
        </div>
      </div>

      <div class="space-y-4 mb-10">
        <div class="p-6 bg-blue-50/50 rounded-3xl flex justify-between items-center border border-blue-100">
          <span class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Rol de Acceso</span>
          <span class="text-xs font-black text-blue-600 uppercase">{{selectedUser?.role}}</span>
        </div>
        <div class="p-6 bg-gray-50/50 rounded-3xl flex justify-between items-center border border-gray-100">
          <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Estado de Cuenta</span>
          <span [ngClass]="selectedUser?.status === 'active' ? 'text-emerald-500' : 'text-rose-500'"
            class="text-xs font-black uppercase">{{selectedUser?.status}}</span>
        </div>
      </div>

      <div class="flex flex-col gap-3">
        <button *ngIf="selectedUser?.role !== 'administrator'" (click)="viewUserHistory(selectedUser?.email)"
          class="w-full bg-blue-600 text-white font-black py-5 rounded-[2rem] shadow-xl shadow-blue-100 hover:bg-blue-700 transition-all text-xs tracking-widest flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          VER HISTORIAL DE RESERVAS
        </button>
        <button (click)="closeOverlay()"
          class="w-full bg-gray-100 text-gray-500 font-black py-5 rounded-[2rem] hover:bg-gray-200 transition-all text-xs tracking-widest">
          CERRAR VENTANA
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="addOverlayOpen"
    class="fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-50 p-6 animate-fade-in"
    (click)="closeAddOverlay()">
    <div class="bg-white/95 backdrop-blur-2xl p-12 rounded-[4rem] shadow-2xl max-w-md w-full border border-white/50"
      (click)="$event.stopPropagation()">
      <h3 class="text-4xl font-black text-gray-800 tracking-tighter mb-10 text-center">Generar Espacios</h3>

      <div class="space-y-8 mb-12">
        <div class="space-y-3">
          <label class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-2">Cantidad a crear</label>
          <input type="number" min="1" [(ngModel)]="newSpacesCount" name="newSpacesCount"
            class="w-full px-8 py-6 bg-gray-50 border border-gray-100 rounded-[2rem] focus:ring-8 focus:ring-blue-500/10 focus:border-blue-500 outline-none font-black text-3xl text-center" />
        </div>
        <p
          class="text-[10px] text-gray-400 font-bold text-center uppercase tracking-widest opacity-60 leading-relaxed italic">
          Los códigos seguirán el patrón<br>A1, A2, A3 dinámicamente
        </p>
      </div>

      <div class="flex gap-4">
        <button (click)="closeAddOverlay()"
          class="flex-1 bg-gray-100 text-gray-500 font-black py-6 rounded-[2rem] hover:bg-gray-200 transition-all text-xs tracking-widest">CANCELAR</button>
        <button (click)="confirmAddSpaces()" [disabled]="isCreatingSpaces || newSpacesCount <= 0"
          class="flex-1 bg-blue-600 text-white font-black py-6 rounded-[2rem] shadow-2xl shadow-blue-200 hover:bg-blue-700 transition-all text-xs tracking-widest disabled:opacity-50 disabled:cursor-not-allowed">
          {{ isCreatingSpaces ? 'GENERANDO...' : 'GENERAR' }}
        </button>
      </div>
    </div>
  </div>
</div>